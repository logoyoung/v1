{"version":3,"sources":["../../javascripts/liveroom.js"],"names":["$","END_FIXED","HEART_CONTENT","HEART_TIMER","LINK_TIMER","SEND_WATCH_TIMER","Math","floor","random","COMMAND_MAP","DEFAULT_MESS_MAP","SOCKET_CODE_MAP","ROOM_CODE_ERROR","webSocketUrl","giftList","giftInitBind","ROOM","a","content","enc","command","data","recive_ms_decode","chat_ms_trans","base64","decode","d","toJSON","t","eval","uid","ROOMID","nn","tpl","welcomeDom","append","domScroll","msgDom","giftDom","silenceDom","followDom","liveEnding","anchorStart","setTimeout","location","href","e","mobileTips","setProperty","userLvIcon","userGroup","sayUser","sayMessage","sendUser","sendContent","sendTimes","followUser","silenceM","webSocket","connect","WebSocket","onopen","LOGIN_MESSAGE","UID","ENCPASS","send","onclose","onerror","onmessage","mes","QuerySocketStr","includes","openLock","heartBeat","chat_ms_check","HEART_MESSAGE","setInterval","on","loginEvent","messageContent","value","val","send_ms_encode","hide","removeClass","blur","giftAndPack","find","off","gid","attr","num","sendType","hasClass","oldNum","html","LiveRoom","_initBindPackEvent","send_gift_encode","giftLock","beanLock","geetestLock","beanTime","bean_level","LIVEID","$ROOM","lastTime","intervalWatch","packData","config","getCookie","QueryLocation","luid","u","liveid","requestUrl","$conf","api","requestData","encpass","ajaxRequest","url","responseData","liveID","index","parseInt","toFixed","web_socket","init","desc","initInfo","title","document","isLiving","show","addClass","anchor","head","poster","orientation","level","nick","numberFormat","viewCount","gameName","followStatus","isFollow","initUserInfo","initStream","user","userInfo","hpbean","hpcoin","setUserCoin","setUserBean","status","stream","streamFix","streamList","waitStream","streamIndex","indexOf","oldUrl","substr","rep","RegExp","successUrl","replace","m3u8URL","video","enableInlineVideo","play","_initLogin","_initLayer","_initBindVideoEvent","_initVideoPlayAddress","_initChangeView","_initAnchorInfo","_initBindChatEvent","_initBeanTime","_initBindBeanEvent","_initBindGiftEvent","setCookie","bindGesture","preventDefault","history","length","window","domain","go","emojiIndex","textObj","get","all","createTextRange","caretPos","text","charAt","setSelectionRange","rangeStart","selectionStart","rangeEnd","selectionEnd","tempStr1","substring","tempStr2","focus","len","navigator","userAgent","match","webkitEnterFullScreen","_initWatchTimeCalc","tap","videoBar","videoPlayBtn","css","pause","size","htmlArr","list","resList","i","push","CreateDom","item","userCount","luids","requsetData","event","lvl","time","timeSort","dom","minute","second","geetest","product","extend","vcode","type","recieve_bean","revCount","client","mode","CreateLi","obj","id","giftname","cost","unit","giftEvent","ulContainer","lists","listLen","ulNum","ceil","j","listOne","k","eq","splice","swiperGift","Swiper","pagination","swiperEmoji","encodeURIComponent","sessionStorage","setItem","packEvent","swiperPack","goodsNum","flag","sendWatchLiveTime","liveTime","currentTime","appVersion","deviceType","realtime","clearInterval","send_bean_encode","way","identity","str_encode","str","msg","toUnicode","mid","Date","getTime","compress","String_fixed","recive_str","zip_inflate","group","uGp","cunn","toEncode","replace_em","word","ounn","gname","giftIcon","timer","gnum","admin","adminNick","targetNick","fn","scrollTo","options","defaults","toT","scrollHeight","durTime","delay","callback","opts","_this","curTop","scrollTop","subTop","dur","round","smoothScroll","per","remove","digitsFormat","coin","bean","b","interval","refUrl"],"mappings":"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","file":"liveroom.js","sourcesContent":["/** Created by junxiao on 2017/7/28. */\n$(function () {\n    const END_FIXED = '\\r\\n';\n    const HEART_CONTENT = 'y8vPLwAA'; // 心跳码\n    const HEART_TIMER = 15 * 1000; //15s 正常16s 发送心跳、避免延迟 提高一秒\n    const LINK_TIMER = 5 * 1000; //5000ms 重连\n    const SEND_WATCH_TIMER = (Math.floor(Math.random() * 21) + 20) * 1000; //20-40秒 发送 时长\n    const COMMAND_MAP = {\n        'result': 'sendCallback',\n        'receivemessage': 'receiveMessage',\n        'network.error': 'netError',\n        'SecurityError': 'securityError'\n    };\n    const DEFAULT_MESS_MAP = {\n        'login.success': '登陆成功',\n        'send.success': '发送成功'\n    };\n    const SOCKET_CODE_MAP = {\n        '501': 'welcome',\n        '502': 'msgShow',\n        '503': '',\n        '504': 'giftMsg',\n        '505': 'silenceMsg',\n        '506': 'userExit',\n        '507': 'follow', //关注\n        '508': 'share', //分享\n        '511': 'treasureopen',\n        '535': 'sendTheAir',\n        '540': 'liveNotice',\n        '541': 'liveStop',\n        '542': 'killUser',\n        '601': 'liveStart',\n        '602': 'liveEnd',\n        '701': 'rRankList',\n        '1100': 'sendCallBack',\n        '1102': 'sendBeanCallBack',\n        '1103': 'sendGiftCallBack',\n        '1104': 'succEnterCallBack'\n    };\n    const ROOM_CODE_ERROR = {\n        '-31'  :  \"用户欢朋币余额不足\",\n        '-32'  :  \"用户欢朋豆余额不足\",\n        '-33'  :  \"尚未认证手机\",\n        '-3001':  '聊天室初始化失败',\n        '-3002':  \"聊天室进入失败\",\n        '-3003':  \"聊天室退出失败\",\n        '-3004':  \"聊天室心跳失败\",\n        '-3005':  \"聊天室消息类型非法\",\n        '-3006':  \"聊天室消息发送失败\",\n        '-3007':  \"聊天室点赞失败\",\n        '-3008':  \"聊天室游客不能说话\",\n        '-3009':  \"用户被禁言，不能发言\",\n        '-3501':  \"消息表写入失败\",\n        '-3502':  \"用户发言失败\",\n        '-3503':  \"获取发言用户信息失败\",\n        '-3504':  \"获取直播信息失败\",\n        '-3505':  \"更新直播赞失败\",\n        '-3506':  \"点赞消息发送失败\",\n        '-3507':  \"获取主播信息失败\",\n        '-3508':  \"礼物全局通知信息发送失败\",\n        '-3509':  \"礼物房间信息发送失败\",\n        '-3510':  \"服务器繁忙\",\n        '-3511':  \"送礼请求参数错误\",\n        '-3512':  \"输入字符不能为空\",\n        '-3513':  \"输入字符不能超过20个字\",\n        '-3514':  \"您的欢朋币余额不足\",\n        '-3530':  \"输入字符含有敏感词汇\"\n    };\n    var webSocketUrl = '';\n    var giftList = {};\n    var giftInitBind = '';\n    /**\n     * ROOM 工具类\n     */\n    class ROOM {\n        constructor() {}\n        static chat_ms_check(a) {\n            if (!DEFAULT_MESS_MAP[a.content]) {\n                if (a.enc == 'no' && COMMAND_MAP[a.command]) {\n                    return\n                }\n                // (解密 socket)\n                if (a.command == 'receivemessage' && a.content) {\n                    if (a.enc == 'yes') {\n                        let data = recive_ms_decode(a.content);\n                        //需 func 处理 JSON串\n                        this.chat_ms_trans(data)\n                    } else if (a.enc == 'no') {\n                        let data = base64.decode(a.content);\n                        this.chat_ms_trans(data)\n                    }\n                }\n            }\n        }\n        static chat_ms_trans(d) {\n            if (d) {\n                var data = toJSON(d);\n                if (SOCKET_CODE_MAP[data.t]) {\n                    eval('this.' + SOCKET_CODE_MAP[data.t] + '(' + d + ')')\n                } else {\n\n                }\n            }\n        }\n        static welcome(d) {\n            if(d.uid == ROOMID || d.nn == ''){\n                return;\n            }\n\n            let tpl = ROOM.welcomeDom(d);\n            $('#chat-div').append(tpl);\n            domScroll();\n        }\n        static msgShow(d) {\n            /*if (!barragerLock) {\n             createBarrager(toEncode(d.msg));\n             }*/\n\n            let tpl = ROOM.msgDom(d);\n            $('#chat-div').append(tpl);\n            domScroll();\n        }\n        static giftMsg(d) {\n            //手机 房管 Level 身份标识  msgid  wait\n            // console.log(d);\n            let tpl = ROOM.giftDom(d);\n            $('#chat-div').append(tpl);\n            domScroll();\n        }\n        static silenceMsg(d) {\n            // console.log(d);\n            let tpl = ROOM.silenceDom(d);\n            $('#chat-div').append(tpl);\n            domScroll();\n        }\n        static userExit(d) { /*console.log('one person exit');*/ }\n        static follow(d) {\n            // console.log(d);\n            let tpl = ROOM.followDom(d);\n            $('#chat-div').append(tpl);\n            domScroll();\n        }\n        static share(d) {\n            // console.log(d);\n        }\n        static treasureopen(d) {\n            // console.log(d);\n            //宝箱开启 暂无\n        }\n        static sendTheAir(d) {\n            //console.log(d);\n            //送飞船动画 暂无\n        }\n        static liveNotice(d) {\n            //console.log(d);\n            //H5直播提示 暂无\n        }\n        static liveStop(d) {\n            // console.log(d);\n            ROOM.liveEnding();\n        }\n        static killUser(d) {\n            // console.log(d);\n            ROOM.liveEnding();\n        }\n        static liveStart(d) {\n            // console.log(d);\n            ROOM.anchorStart();\n        }\n        static liveEnd(d) {\n            // console.log(d);\n            let tpl = ROOM.liveEnding();\n            $('#chat-div').append(tpl);\n            domScroll();\n            setTimeout(function () {\n                location.href = location.href;\n                //config();\n            }, 3000);\n        }\n        static rRankList(d) {\n            //console.log(d);\n            //排行榜暂无\n        }\n        static sendCallBack(d) {\n            // console.log('sendCallBack:::::>'+d);\n            if(ROOM_CODE_ERROR[d.e]){\n                mobileTips(ROOM_CODE_ERROR[d.e], 3);\n            }\n        }\n        static sendBeanCallBack(d) {\n            //giftLock = false;\n            // console.log(d);\n            setProperty(d);\n            if(ROOM_CODE_ERROR[d.e]){\n                mobileTips(ROOM_CODE_ERROR[d.e], 3);\n            }\n        }\n        static sendGiftCallBack(d) {\n            //giftLock = false;\n            // console.log('sendGiftCallBack:::::::>'+d);\n            setProperty(d);\n            if(ROOM_CODE_ERROR[d.e]){\n                mobileTips(ROOM_CODE_ERROR[d.e], 3);\n            }\n        }\n        static succEnterCallBack(d) {\n            // console.log(d);\n        }\n        static welcomeDom(d){\n            return '<li class=\"chat-cell\"><img class=\"welcome\" src=\"images/emoji/welcome.png\"><span class=\"text\">&nbsp;欢迎&nbsp;</span>'+ userLvIcon(d) +'<span class=\"person-name normal\">'+d.nn+'</span><span class=\"text\">&nbsp;进入直播间</span></li>';\n        }\n        static msgDom(d){\n            return '<li class=\"chat-cell\">'+userGroup(d) + userLvIcon(d) + sayUser(d)  + sayMessage(d) +'</li>';\n        }\n        static giftDom(d){\n            return '<li class=\"chat-cell\">'+userGroup(d) + userLvIcon(d) + sendUser(d)  + sendContent(d) + sendTimes(d) + '</li>'\n        }\n        static followDom(d){\n            return '<li class=\"chat-cell\">'+ userGroup(d) + userLvIcon(d)+ followUser(d) + '</li>';\n        }\n        static silenceDom(d){\n            return '<li class=\"chat-cell\" style=\"color:#f44336;\">'+ silenceM(d) +'</li>';\n        }\n        static liveEnding(){\n            return '<li class=\"chat-cell\" style=\"color:#f44336;\"><span class=\"message\" style=\"color:#f44336;\">系统广播：直播结束</span></li>';\n        }\n        static anchorStart(){\n            location.href = location.href;\n            //config();\n        }\n    }\n\n    var webSocket = null;\n\n    var connect = () => {\n        //websocket Events override\n        webSocket = new WebSocket(webSocketUrl);\n        webSocket.onopen = (e => {\n            // console.log('与服务器端建立连接');\n            let LOGIN_MESSAGE = 'command=login' + END_FIXED + 'uid=' + UID + END_FIXED + 'encpass=' + ENCPASS + END_FIXED + 'roomid=' + ROOMID + END_FIXED;\n            //尝试登陆\n            webSocket.send(LOGIN_MESSAGE);\n        });\n        webSocket.onclose = (e => {\n            // setTimeout(function() {\n            //     connect();\n            //     console.log('正在重连...');\n            // }, LINK_TIMER);\n            // console.log('链接已断开');\n        });\n        webSocket.onerror = (e => {\n            // connect();\n        });\n        webSocket.onmessage = (e => {\n            let mes = QuerySocketStr(e.data);\n            if (mes.content.includes('login.success')) {\n                openLock = true;\n                webSocket.heartBeat();\n            } else if (mes.content.includes('login.fail')) {\n                openLock = false;\n                webSocket.onclose();\n            }\n            ROOM.chat_ms_check(mes);\n        });\n        //heartbeat WebSocket心跳\n        webSocket.heartBeat = (e => {\n            let HEART_MESSAGE = 'command=sendmessage' + END_FIXED + 'content=' + HEART_CONTENT + END_FIXED;\n            setInterval(function() {\n                webSocket.send(HEART_MESSAGE);\n            }, HEART_TIMER);\n        });\n\n        // 发送消息\n        $('#sendMessage-btn').on('tap', function(){\n            if(!loginEvent()){\n                return;\n            }\n\n            var messageContent = $('#message-content');\n            var value = messageContent.val();\n            if(value != ''){\n\n                /***/\n                webSocket.send(send_ms_encode(value));\n                $('.mask').hide() && $('.chat-box, .body').removeClass('int') && $('.chat-btn .input').blur() && $('#message-content').val('');\n            }else{\n                return;\n            }\n        });\n        giftAndPack();\n        \n    };\n\n    var giftAndPack = ()=> {\n\n        // console.log($('.lw_item'));\n        //送礼\n        $('.gift-content').find('.lw_item').off('click').on('click', function () {\n            // console.log($(this));\n            if(!loginEvent()){\n                return;\n            }\n            var gid = $(this).attr('data-gid') ? $(this).attr('data-gid') : null;\n            var num = $(this).attr('data-num') ? $(this).attr('data-num') : 1;\n            var sendType = 0;\n            if($(this).hasClass('coin')){\n                sendType = 0;\n            }else if($(this).hasClass('pack')){\n                sendType = 1;\n                var oldNum = $(this).find('.num').html();\n                if(oldNum <= 1){\n                    LiveRoom._initBindPackEvent();\n                }else{\n                    $(this).find('.num').html(oldNum-1);\n                    LiveRoom._initBindPackEvent();\n                }\n            }\n            if(gid && num){\n                webSocket.send(send_gift_encode(gid, num, sendType));\n                //giftLock = true;\n            }\n        });\n    };\n\n    /**\n     *@param: 礼物锁、socket锁\n     */\n    var giftLock = false,\n        openLock = false,\n        beanLock = false,\n        geetestLock = false,\n        beanTime = 0,\n        bean_level = 1,\n        UID = null,\n        ENCPASS = null,\n        ROOMID = null,\n        LIVEID = null,\n        $ROOM = null,   //初始化 房间信息\n        lastTime = 0,   //上次观看时间\n        intervalWatch = null,\n        packData = null; //背包礼物\n\n    //配置UID ENC LUID等变量\n    var config  = () => {\n        UID     = getCookie('_uid')      || 3000000000;\n        ENCPASS = getCookie('_enc')      || 'gustuserenterencpass';\n        ROOMID  = QueryLocation().luid   || QueryLocation().u || ''; //luid = ROOMID\n        LIVEID  = QueryLocation().liveid   || '';\n        if(ROOMID == ''){\n            return;\n        }\n        var requestUrl  = $conf.api + 'room/getLiveRoomInfo.php';\n        var requestData = {\n                uid     : getCookie('_uid') || '',\n                encpass : getCookie('_enc') || '',\n                luid    : ROOMID\n        };\n        ajaxRequest({url:requestUrl, data:requestData}, function (responseData) {\n            // console.log(responseData);\n            /*if(IsPC()){\n                location.href = $conf.domain + responseData.roomID;\n                return;\n            }*/\n            $ROOM = responseData;\n            ROOMID = $ROOM.luid;    //覆盖ROOMID\n            LIVEID = $ROOM.liveID; //覆盖LIVEID\n            var index = parseInt(Math.random().toFixed(0));\n            // console.log('webSoket['+index+']');\n            if(!$ROOM.web_socket[index]){\n                webSocketUrl = 'ws://' + $ROOM.web_socket[0];\n            }else{\n                webSocketUrl = 'ws://' + $ROOM.web_socket[index];\n            }\n\n            LiveRoom.init();\n        }, function (responseData) {\n            mobileTips(responseData.desc, 3);\n        });\n    };\n    //初始化 房间信息\n    var initInfo = () => {\n\n        //初始化标题\n        $('header>span').html($ROOM.title);\n        document.title = $ROOM.title;\n        //初始化 直播状态及封面图\n        if($ROOM.isLiving == '0'){\n            $('.liveroom-content').find('.play-btn').hide();\n            $('.liveroom-content').find('.nolive').show();\n\n            $('.liveroom-content').find('.poster').show().addClass('filter').attr('src', $ROOM.anchor.head);\n        }else if($ROOM.isLiving == '1'){\n            $('.liveroom-content').find('.nolive').hide();\n            $('.liveroom-content').find('.play-btn').show();\n            $('.liveroom-content>.video').attr('poster', $ROOM.poster);\n            if($ROOM.orientation == '0' && $ROOM.poster != ''){\n                $('.liveroom-content').find('.poster').removeClass('filter').removeClass('landscape').addClass('portrait').attr('src', $ROOM.poster);\n            }else if($ROOM.orientation == '1'  && $ROOM.poster != ''){\n                $('.liveroom-content').find('.poster').removeClass('filter').removeClass('portrait').addClass('landscape').attr('src', $ROOM.poster);\n            }else{\n                $('.liveroom-content').find('.poster').hide();\n            }\n        }\n\n        //初始化 主播信息\n        //头像\n        $('.anchor-info').find('.room-head').attr('src', $ROOM.anchor.head);\n        //昵称\n        $('.anchor-info').find('.anchor-desc').html('<span class=\"ms-lv lv'+$ROOM.anchor.level+'\"></span><span class=\"room-title\">'+$ROOM.anchor.nick+'</span>');\n        //在线人数\n        $('.anchor-info').find('#viewCount').html(numberFormat($ROOM.viewCount));\n        //直播游戏名称\n        $('.anchor-info').find('.room-game').html($ROOM.gameName);\n        //初始化 关注状态\n        followStatus($ROOM.isFollow);\n        //初始化 个人信息\n        initUserInfo($ROOM);\n        //初始化 流地址\n        initStream(ROOMID);\n    };\n\n    //初始化 个人信息\n    var initUserInfo = function (a) {\n        if(!a || !a.user || !getCookie('_uid') || !getCookie('_enc')){\n            return;\n        }\n        var userInfo = a.user;\n        if(userInfo.hpbean && userInfo.hpcoin){\n            setUserCoin(userInfo.hpcoin);\n            setUserBean(userInfo.hpbean);\n            $('.gift-content').find('.userMoney').addClass('show');\n        }\n    };\n\n    //初始化 流地址\n    var initStream = function (ROOMID, status) {\n        var requestUrl = $conf.api+'live/getHlsStreamList.php';\n        var requestData = {\n            luid : ROOMID\n        };\n        ajaxRequest({url:requestUrl,data:requestData}, function (responseData) {\n            if(responseData.stream != ''){\n                //流地址前缀\n                var streamFix = responseData.streamList[0] + '/';\n                //待拼接流地址\n                var waitStream = responseData.stream;\n                //找到拼接位置\n                var streamIndex = responseData.stream.indexOf('?');\n                //待拼接内容\n                var oldUrl = responseData.stream.substr(0, streamIndex);\n                var rep = new RegExp(oldUrl);\n                //替换地址\n                var successUrl = waitStream.replace(rep, oldUrl + '/playlist.m3u8');\n                //拼接\n                var m3u8URL = 'http://'+streamFix + successUrl;\n\n                $('.video').attr('src', m3u8URL);\n\n                if(status == 1){\n                    var video = $('video')[0];\n                    enableInlineVideo(video);\n                    video.play();\n                    $('.video').addClass('play');\n                }else{\n                    return;\n                }\n            }else{\n                /* 下播状态 */\n\n            }\n        }, function (responseData) {\n            //error\n        });\n    };\n\n    // config => initGift =>webSocket => initInfo => initStream\n    //配置UID等 =>  socket服务登录 => 初始化房间信息 => 初始化 播放流地址\n    config();\n\n    var LiveRoom = {\n        init: function (){\n            this._initLogin();              //登录\n            this._initLayer();              //界面\n            this._initBindVideoEvent();     //直播视频相关事件\n            this._initVideoPlayAddress();   //直播地址相关事件\n            this._initChangeView();         //聊天 评论View切换\n            this._initAnchorInfo();         //主播信息及事件\n            this._initBindChatEvent();      //聊天相关事件\n            this._initBeanTime();\n            this._initBindBeanEvent();      //领豆相关事件\n            this._initBindGiftEvent();      //礼物相关事件\n            this._initBindPackEvent();      //背包相关事件\n\n        },\n        _initLogin: () => {\n            setCookie('ref_url', '');\n        },\n        _initLayer: () => {\n            //返回上层页面\n            bindGesture($('#backToView'), function (e) {\n                //touchstart\n                e.preventDefault();\n                $(this).removeClass('normal').addClass('high');\n            }, function () {\n                $(this).removeClass('high').addClass('normal');\n            }, function () {\n                if( history.length == 1 || window.history.length == 1){\n\n                    location.href = $conf.domain + 'mobile/index.html';\n                }else{\n                    window.history.go(-1);\n                }\n\n            });\n            \n            //emoji\n            // $('.emoji-container').swiper({\n            //     pagination: $('.emoji-pagination', this)\n            // });\n\n            //emoji int\n            $('#emoji-content').find('.emoji').on('tap', function () {\n                var index = $(this).index() + 1;\n                var emojiIndex = '[em_'+index+']';\n\n                var textObj = $('#message-content').get(0);\n                if(document.all && textObj.createTextRange && textObj.caretPos){\n                    var caretPos=textObj.caretPos;\n                    caretPos.text = caretPos.text.charAt(caretPos.text.length-1) == '' ?\n                        emojiIndex+'' : emojiIndex;\n                } else if(textObj.setSelectionRange){\n                    var rangeStart=textObj.selectionStart;\n                    var rangeEnd=textObj.selectionEnd;\n                    var tempStr1=textObj.value.substring(0,rangeStart);\n                    var tempStr2=textObj.value.substring(rangeEnd);\n                    textObj.value=tempStr1+emojiIndex+tempStr2;\n                    textObj.focus();\n                    var len=emojiIndex.length;\n                    textObj.setSelectionRange(rangeStart+len,rangeStart+len);\n                    textObj.blur();\n                }else{\n                    textObj.value+=emojiIndex;\n                }\n\n            });\n        },\n        _initBindVideoEvent: () => {\n            //播放 按钮 事件\n            bindGesture($('.liveroom-content>.play-btn'), function (e) {\n                //touchstart\n                e.preventDefault();\n                $(this).removeClass('normal').addClass('high');\n            }, function () {\n                //touchend\n                $(this).removeClass('high').addClass('normal');\n            }, function () {\n                //tap\n                $('.liveroom-content>.video')[0].play();\n                $('.video').addClass('play');\n                if(window.navigator.userAgent.match(/OS [9]_\\d[_\\d]* like Mac OS X/i) || window.navigator.userAgent.match(/OS [8]_\\d[_\\d]* like Mac OS X/i)){\n                    $('.liveroom-content>.video')[0].play();\n                    $('.video').addClass('play');\n                    $('.liveroom-content>.video')[0].webkitEnterFullScreen();\n                }\n                setTimeout(function () {\n                    $('.liveroom-content>.play-btn').hide();\n                    $('.video-bar').addClass('show');\n                    setTimeout(function(){ $('.video-bar').removeClass('show')}, 5000);\n                    $('.liveroom-content>.poster').hide();\n                }, 1000);\n\n                //观看统计\n                //观看时长统计 flag: 1开始 flag: 0停止\n                if(getCookie('_uid') && getCookie('_enc')){\n                    LiveRoom._initWatchTimeCalc(1);\n                }else{\n                    LiveRoom._initWatchTimeCalc(0);\n                }\n            });\n\n            //video-bar display\n            $('.liveroom-content>.video').tap(function () {\n                var videoBar = $('.video-bar');\n                var videoPlayBtn = $('.liveroom-content>.play-btn');\n                if(videoPlayBtn.css('display') == 'none'){\n                    videoBar.hasClass('show') ? videoBar.removeClass('show') : videoBar.addClass('show') && setTimeout(function(){ videoBar.removeClass('show')}, 5000)\n                }\n            });\n\n            //video pause\n            bindGesture($('.video-bar>.video-pause'), function (e) {\n                //touchstart\n                e.preventDefault();\n                $(this).removeClass('normal').addClass('high');\n            }, function () {\n                //touchend\n                $(this).removeClass('high').addClass('normal');\n            }, function () {\n                //tap\n                $('.liveroom-content>.video')[0].pause();\n                $('.video-bar').removeClass('show') && $('.play-btn').show();\n                //观看时长统计关闭\n                LiveRoom._initWatchTimeCalc(0);\n            });\n\n            $('.video-refresh').on('tap', function () {\n                initStream(ROOMID, 1);\n\n            });\n\n            //video webkit-fullscreen\n            bindGesture($('.video-bar>.video-full'), function (e) {\n                //touchstart\n                e.preventDefault();\n                $(this).removeClass('normal').addClass('high');\n            }, function () {\n                //touchend\n                $(this).removeClass('high').addClass('normal');\n            }, function () {\n                //tap\n                $('.liveroom-content>.video')[0].webkitEnterFullScreen();\n            });\n\n\n        },\n        _initVideoPlayAddress: () => {\n            var video = $('video').get(0);\n            enableInlineVideo(video);\n        },\n        _initChangeView: () => {\n            // 聊天 推荐 下划线 事件添加\n            $('#chatView-btn').on('tap', function () {\n                $('.sec-box li span').removeClass('sel');\n                $(this).addClass('sel');\n                $('.commend-selbox').hide() && $('.chat-selbox, .chat-box').show();\n            });\n            $('#commendView-btn').on('tap', function () {\n                $('.sec-box li span').removeClass('sel');\n                $(this).addClass('sel');\n                $('.chat-selbox, .chat-box').hide() && $('.commend-selbox').show();\n                if($('.commend-selbox .live-list').find('.live-one').length == 0){\n                    var requestUrl = $conf.api + 'other/guessYouLike.php';\n                    var requestData = {\n                        uid: getCookie('_uid') || '',\n                        encpass: getCookie('_enc') || '',\n                        size: 6\n                    };\n                    var htmlArr = [];\n                    ajaxRequest({url: requestUrl, data: requestData}, function (responseData) {\n                        if( responseData.list && responseData.list.length > 0 ){\n                            $('.commend-selbox .commend-title').show();\n                        }\n                        var resList = responseData.list;\n                        // console.log(resList);\n                        for(var i = 0; i < resList.length; i++){\n                            htmlArr.push(CreateDom(resList[i]));\n                        }\n\n                        $('.commend-selbox').find('.live-list').html(htmlArr);\n                    }, function (responseData) {\n                        mobileTips(responseData.desc, 3);\n                    });\n                    $('.commend-selbox .live-list').html(htmlArr);\n                }\n            });\n\n            $('.close-download').on('tap', function () {\n                $('.download-btn').hide();\n            });\n\n            function CreateDom(item){\n                if(item.uid == ROOMID){\n                    return '';\n                }\n                if(item.orientation == 1){\n                    return '<li class=\"live-one\">\\\n                            <a href=\"'+$conf.domain+'mobile/room/room.html?luid='+item.uid+'\">\\\n                            <div class=\"poster\">\\\n                            <div class=\"snapshot\">\\\n                            <img class=\"horizontal\" src=\"'+item.poster+'\">\\\n                            <p class=\"game-title\">'+item.gameName+'</p>\\\n                        </div>\\\n                        <div class=\"profile-photo\">\\\n                            <img src=\"'+item.head+'\">\\\n                            </div>\\\n                            <div class=\"poster-info\">\\\n                            <p class=\"poster-name\">'+numberFormat(item.userCount)+'人</p>\\\n                        <p class=\"audience\">'+item.title+'</p>\\\n                        </div>\\\n                        <section class=\"room-name\">'+item.nick+'</section>\\\n                        </div>\\\n                        </a>\\\n                        </li>';\n                }else{\n                    return '<li class=\"live-one\">\\\n                            <a href=\"'+$conf.domain+'mobile/room/room.html?luid='+item.uid+'\">\\\n                            <div class=\"poster\">\\\n                            <div class=\"snapshot\">\\\n                            <img class=\"vertical\" src=\"'+item.poster+'\">\\\n                            <p class=\"game-title\">'+item.gameName+'</p>\\\n                        </div>\\\n                        <div class=\"profile-photo\">\\\n                            <img src=\"'+item.head+'\">\\\n                            </div>\\\n                            <div class=\"poster-info\">\\\n                            <p class=\"poster-name\">'+numberFormat(item.userCount)+'人</p>\\\n                        <p class=\"audience\">'+item.title+'</p>\\\n                        </div>\\\n                        <section class=\"room-name\">'+item.nick+'</section>\\\n                        </div>\\\n                        </a>\\\n                        </li>';\n                }\n            }\n        },\n        _initAnchorInfo: () => {\n            //主播信息 按钮 事件\n            bindGesture($('.anchor-display'), function(e){\n                //touchstart\n                e.preventDefault();\n                $('.anchor-info').hasClass('none') ?\n                    $(this).removeClass('hide').addClass('hide-high') :\n                    $(this).removeClass('show').addClass('show-high');\n            }, function () {\n                //touchend\n                $('.anchor-info').hasClass('none') ?\n                    $(this).removeClass('hide').addClass('hide-high') :\n                    $(this).removeClass('show-high').addClass('show');\n            }, function () {\n                //tap\n                $('.anchor-info').hasClass('none') ?\n                    $('.anchor-info, .chat-container').removeClass('none') &&\n                    $(this).removeClass('hide').removeClass('hide-high').addClass('show') :\n                    $('.anchor-info, .chat-container').addClass('none') &&\n                    $(this).removeClass('show').removeClass('show-high').addClass('hide');\n            });\n            //关注主播 按钮事件\n            $('.follow-btn').on('tap', function () {\n                if(!loginEvent()){\n                    return;\n                    //立即登录\n                }\n                if(UID && ENCPASS && ROOMID){\n                    var requestUrl = '';\n                    if(!$(this).hasClass('cancel')){\n                        requestUrl = $conf.api + 'room/followUser.php';\n                        var requestData = {\n                            uid: UID,\n                            encpass: ENCPASS,\n                            luid: ROOMID\n                        };\n                        ajaxRequest({url:requestUrl,data:requestData}, function (responseData) {\n                            followStatus(1);\n                        });\n                    }else{\n                        requestUrl = $conf.api + 'room/followUserCancel.php';\n                        var requestData = {\n                            uid: UID,\n                            encpass: ENCPASS,\n                            luids: ROOMID\n                        }\n                        ajaxRequest({url:requestUrl,data:requestData}, function (responseData) {\n                            followStatus(0);\n                        });\n                    }\n                }else{\n                    //else login\n                }\n            });\n        },\n        _initBindChatEvent: () => {\n            //聊天 按钮事件\n            bindGesture($('.chat-btn .input'), function (e) {\n                //touchstart\n                e.preventDefault();\n                $(this).removeClass('normal').addClass('high');\n            }, function () {\n                //touchend\n                $(this).removeClass('high').addClass('normal');\n                $('.emoji-content').hasClass('show') ? $('.emoji-content').removeClass('show') : '';\n                $(this).focus() && $('.mask').show();\n            }, function () {\n                //tap\n                $(this).focus();\n            });\n\n            $('.chat-btn .input').focus(function () {\n                $('.chat-box ,.body').addClass('int');\n            }).blur(function () {\n                $('.body').removeClass('int');\n            });\n            //mask 取消input事件\n            $('.mask').on('tap', function () {\n                $(this).hide() && $('.chat-box, .body').removeClass('int') && $('.chat-btn .input').blur();\n            });\n\n            $('#emoji-content .delete-btn').on('tap', function () {\n                $('#message-content').val('');\n            });\n\n            //emoji 按钮事件\n            bindGesture($('.emoji-btn'), function (e) {\n                e.preventDefault();\n            }, function () {\n\n            }, function () {\n                if(!$('.emoji-content').hasClass('show')){\n                    $('.emoji-content').addClass('show') && $('.chat-btn .input').blur();\n                }else{\n                    $('.emoji-content').removeClass('show') && $('.chat-btn .input').focus();\n                }\n            });\n\n\n        },\n        _initBeanTime: () => {\n            if(!getCookie('_uid') || !getCookie('_enc')){\n                return;\n            }\n            var requestUrl = $conf.api + 'room/shamApi_gb_enter.php';\n            var requsetData = {\n                uid: getCookie('_uid'),\n                encpass: getCookie('_enc'),\n                luid: ROOMID,\n                event: 'enter'\n            };\n            ajaxRequest({url: requestUrl, data: requsetData}, function (responseData) {\n                // console.log(responseData);\n                bean_level = responseData.lvl;\n                if(bean_level == 6){\n                    return;\n                }\n                if(responseData.time > 0){\n                    beanLock = false;\n                    beanTime = responseData.time;\n                    timeSort();\n                }else{\n                    beanLock = true;\n                }\n            }, function (responseData) {\n                mobileTips(responseData.desc, 3);\n            })\n        },\n        _initBindBeanEvent: () => {\n            //领豆 按钮事件\n            bindGesture($('.bean-btn'), function (e) {\n                //touchstart\n                e.preventDefault();\n                $(this).removeClass('normal').addClass('high');\n            }, function () {\n                //touchend\n                $(this).removeClass('high').addClass('normal');\n            }, function () {\n                // console.log(beanLock);\n                if(!loginEvent()){\n                    return;\n                }\n                if(bean_level == 6){\n                    var dom = '已经领取6次咯~';\n                    mobileTips(dom ,3);\n                    return;\n                }\n                if(!beanLock && beanTime > 0){\n                    var minute = parseInt(beanTime / 60);\n                    var second = parseInt(beanTime % 60);\n                    \n                    if( minute > 0){\n                        var time = minute + ' 分钟后可领取';\n                        mobileTips(time, 1);\n                        return;\n                    }else{\n                        var time = second + ' 秒钟后可领取';\n                        mobileTips(time, 1);\n                        return;\n                    }\n                }else{\n                    if(!loginEvent()){\n                        return;\n                    }\n                    if(!geetestLock || $('.gt_holder').hasClass('gt_hide')){\n                        geetestLock = true;\n                        geetest({product: 'popup', append: '#geetest'}, function (data) {\n                            geetestLock = false;\n                            var requestData = $.extend({\n                                uid: getCookie('_uid'),\n                                encpass: getCookie('_enc'),\n                                luid: ROOMID,\n                                event: 'pick',\n                                lvl: bean_level,\n                                vcode: 0,\n                                type:'gt'\n                            }, data);\n\n                            var requestUrl = $conf.api + 'room/shamApi_gb_enter.php';\n                            ajaxRequest({url: requestUrl, data: requestData}, function (responseData) {\n                                // console.log(responseData);\n                                var recieve_bean = '领取了 <span>' +responseData.revCount + '</span> 个欢朋豆';\n                                mobileTips(recieve_bean, 2);\n                                setProperty(responseData);\n                                bean_level = responseData.lvl;\n                                beanTime = responseData.time;\n                                timeSort();\n                                beanLock = false;\n                            }, function (responseData) {\n                                mobileTips(responseData.desc, 3);\n                            })\n                        })\n                    }else{\n                        return;\n                    }\n                }\n\n\n            });\n\n        },\n        _initBindGiftEvent: () => {\n            //initGift List\n            var requestUrl = $conf.api + 'gift/getGiftShowList.php';\n            var requestData = {\n                client : 1,\n                luid   : ROOMID,\n                type   : '0',   //100:全部，0:直播间赠送礼物//注意当type为100的时候，luid值不起作用\n                mode   : '0'      //0：所有信息，1：比较模式只返回总mark, 2:配置模式，只返回礼物ID以及数量和排序\n            };\n            var CreateLi = function (obj) {\n              return '<li class=\"lw_item coin\" data-gid=\"'+obj.id+'\" data-num=\"'+obj.num+'\">\\\n                          <div class=\"img\">\\\n                            <img src=\"'+obj.poster+'\">\\\n                            </div>\\\n                            <p class=\"desc\">'+obj.giftname+'</p>\\\n                            <p class=\"price\">'+obj.cost+obj.unit+'</p>\\\n                        </li>';\n            };\n            var giftEvent = function (responseData) {\n                var htmlArr = [];\n                var ulContainer = '<ul class=\"gift-box swiper-slide\"></ul>';\n\n                var lists = responseData.list;\n                var listLen = responseData.list.length;\n\n                var ulNum = Math.ceil(listLen/8);\n                for(var j = 0; j < ulNum; j++){\n                    $('#gift-ul-con').append(ulContainer);\n                }\n\n                for(var i = 0; i < lists.length; i++){\n                    var listOne = lists[i];\n                    giftList[listOne.id] = listOne.poster;\n                    htmlArr.push(CreateLi(listOne));\n                }\n\n                for(var k =0; k<ulNum; k++){\n                    $('#gift-ul-con').find('.gift-box').eq(k).html(htmlArr.splice(0, 8));\n                }\n                var swiperGift = new Swiper ('.gift-container', {\n                    pagination: '.gift-pagination'\n                });\n                var swiperEmoji = new Swiper('#emoji-content', {\n                    pagination: '.emoji-pagination'\n                });\n                // $('.gift-content').find('.gift-box').html(htmlArr);\n\n                connect();\n                initInfo();\n\n            };\n\n            ajaxRequest({url: requestUrl,data: requestData}, function (responseData) {\n                giftEvent(responseData);\n            }, function (responseData) {\n                mobileTips(responseData.desc, 3);\n            });\n            //gift modal\n            $('.modal').on('tap', function () {\n                $(this).hide();\n                $('.gift-content').removeClass('show');\n            });\n            //送礼 按钮事件\n            bindGesture($('.gift-btn'), function (e) {\n                //touchstart\n                e.preventDefault();\n                $(this).removeClass('normal').addClass('high');\n            }, function () {\n                $(this).removeClass('high').addClass('normal');\n            }, function () {\n                $('.gift-content').addClass('show') && $('.modal').show();\n            })\n\n            //充值按钮\n            $('.recharge>a').on('tap', function (e) {\n                e.preventDefault();\n            });\n            $('.recharge').on('tap', function () {\n                var oldUrl = encodeURIComponent(location.href);\n                sessionStorage.setItem('ref_url', oldUrl);\n                location.href = $conf.domain + 'mobile/index.html#/inpour?roomlink=room';\n            });\n        },\n        _initBindPackEvent: () => {\n\n            var packEvent = function (responseData){\n                var htmlArr = [];\n                var ulContainer = '<ul class=\"pack-box swiper-slide\"></ul>';\n\n                var lists = responseData.list;\n                var listLen = responseData.list.length;\n\n                if(listLen <= 8){\n                    $('.pack-container').find('.pack-pagination').hide();\n                }\n\n                var ulNum = Math.ceil(listLen/8);\n                $('#pack-ul-con').html('');//先清空内容\n                for(var j = 0; j < ulNum; j++){\n                    $('#pack-ul-con').append(ulContainer);\n                }\n\n                for(var i = 0; i < lists.length; i++){\n                    var listOne = lists[i];\n                    giftList[listOne.id] = listOne.poster;\n                    htmlArr.push(CreateLi(listOne));\n                }\n\n                for(var k =0; k<ulNum; k++){\n                    $('#pack-ul-con').find('.pack-box').eq(k).html(htmlArr.splice(0, 8));\n                }\n\n                var swiperPack = new Swiper ('.pack-container', {\n                    pagination: '.pack-pagination'\n                });\n\n                giftAndPack();\n\n            };\n            var CreateLi = function (obj) {\n                return '<li class=\"lw_item pack\" data-gid=\"'+obj.id+'\" data-num=\"1\">\\\n                          <div class=\"img\">\\\n                            <img src=\"'+obj.poster+'\">\\\n                            </div>\\\n                            <p class=\"desc\">'+obj.giftname+'</p>\\\n                            <span class=\"num\">'+obj.goodsNum+'</span>\\\n                        </li>';\n            };\n            var requestUrl = $conf.api + 'giftpack/myGiftGoods.php';\n            if(!getCookie('_uid')||!getCookie('_enc')){\n                return;\n            }\n            var requestData = {\n                uid : UID,\n                encpass   : ENCPASS\n            };\n\n\n\n            if(!packData){\n                ajaxRequest({url: requestUrl,data: requestData}, function (responseData) {\n                    packData = responseData;\n                    packEvent(packData);\n                }, function (responseData) {\n                    mobileTips(responseData.desc, 3);\n                });\n            }else{\n                packEvent(packData);\n            }\n\n\n\n\n            //礼物 背包 切换\n            $('#gift-content-btn').on('tap', function () {\n                $('.gift-sec li span').removeClass('sel');\n                $(this).addClass('sel');\n                $('.pack-container').removeClass('show') && $('.gift-container').show();\n            });\n            $('#pack-content-btn').on('tap', function () {\n                if(!loginEvent()){\n                    return;\n                }\n                $('.gift-sec li span').removeClass('sel');\n                $(this).addClass('sel');\n                $('.gift-container').hide() && $('.pack-container').addClass('show');\n            });\n\n        },\n        _initWatchTimeCalc: (flag) => {\n\n            var sendWatchLiveTime = function() {\n                var requestUrl = $conf.api + 'statistics/liveViewStatistics.php';\n                var liveTime = parseInt($('video')[0].currentTime);\n                if(lastTime == liveTime){\n                    return;\n                }\n                // alert('当前时长:'+ liveTime +'----上次时长:'+ lastTime);\n                var requestData = {\n                    uid: UID,\n                    encpass: ENCPASS,\n                    luid: ROOMID,\n                    liveid: LIVEID,\n                    appVersion: '1.0.5',\n                    deviceType: 5,\n                    realtime: liveTime - lastTime\n                };\n                ajaxRequest({url: requestUrl, data: requestData}, function (responseData) {\n                    lastTime = liveTime;\n                },function(responseData){\n                    lastTime = liveTime;\n                    // console.log(responseData);\n                })\n            };\n            if(flag === 1){\n                clearInterval(intervalWatch);\n                intervalWatch = setInterval(sendWatchLiveTime, SEND_WATCH_TIMER);\n            }else if(flag === 0){\n                for(var i = 0; i < 5; i++){\n                    clearInterval(intervalWatch);\n                }\n            }\n\n        }\n    };\n\n\n    /**\n     * [送礼 加密]\n     * @param  {[string]} gid [需加密文字]\n     */\n    function send_gift_encode(gid, num, sendType) {\n        //gid   礼物 个数\n        if (!gid) {\n            return\n        }\n        if(gid == '31' && num != ''){\n            return send_bean_encode(num)\n        }\n        if(!getCookie('_uid') || !getCookie('_enc')){\n            return false;\n            /**/\n        }\n        let content = {\n            t: 103,\n            enc: ENCPASS,\n            gid: gid,\n            liveid: LIVEID,\n            way: '1',\n            identity: '1',\n            sendType: sendType\n        };\n\n        return str_encode(content)\n    }\n    function send_bean_encode(num) {\n        if (!num || num < 1 || num > 10000) {\n            return\n        }\n        let content = {\n            t: 102,\n            enc: ENCPASS,\n            gid: '31', //欢朋豆 暂定 31\n            liveid: LIVEID,\n            num: num,\n            identity: '1'\n        };\n        return str_encode(content)\n    }\n    /**\n     * [发送消息 加密]\n     * @param  {[string]} str [需加密文字]\n     */\n    function send_ms_encode(str) {\n        if (!str) {\n            return;\n        }\n        if(!getCookie('_uid') || !getCookie('_enc')){\n            return false;\n            /**/\n        }\n        let content = {\n            t: 100,\n            uid: UID,\n            msg: toUnicode(str),\n            mid: new Date().getTime(),\n            way: 0\n        };\n        return str_encode(content);\n    }\n    /**\n     * [接收消息 解密]\n     * @param  {[string]} str [需解密文字]\n     */\n    function recive_ms_decode(str) {\n        //解密\n        let compress = String_fixed(str, 'decode');\n        let recive_str = zip_inflate(base64.decode(compress));\n        return recive_str\n    };\n    function userGroup(a){\n        if(!a || !a.group){ return; }\n        var uGp = parseInt(a.group);\n        if(uGp == 1){\n            return '';\n        }else if(uGp == 4){\n            return '<span class=\"mg\">房管</span>';\n        }else if(uGp == 5){\n            return '<span class=\"an\">主播</span>';\n        }\n    };\n    function userLvIcon(a) {\n        if(!a || !a.level){ return;}\n        return '<span class=\"us-lv lv'+ a.level +'\"></span>';\n    };\n    function sayUser(a) {\n        if(!a || !a.cunn){ return;}\n        return '<span class=\"person-name normal\">'+a.cunn+':</span>';\n    };\n    function sayMessage(a) {\n        if(!a || !a.msg){ return;}\n        return '<span class=\"message\">'+ toEncode(replace_em(a.msg)) +'</span>';\n    };\n    function replace_em(str){\n        str = str.replace(/\\</g,'&lt;');\n        str = str.replace(/\\>/g,'&gt;');\n        str = str.replace(/\\n/g,'<br/>');\n        str = str.replace(/\\[em_([0-9]*)\\]/g, function(word){\n\n            var num = word.match(/\\d{1,2}/g);\n            num = num[0] ? num[0] : '';\n            var str = word;\n            num && num < 23 && (str='<img class=\"emoji\" src=\"images/emoji/'+num+'.png\" >');\n            return str;\n        });\n        return str;\n    };\n    function sendUser(a) {\n        if(!a || !a.ounn){ return;}\n        return '<span class=\"person-name gift\">'+a.ounn+':</span>';\n    };\n    function sendContent(a) {\n        //礼物img\n        return '<span class=\"message\"> 赠送给主播</span><span class=\"person-name gift\">'+a.gname+'</span>'+ giftIcon(a) +'';\n    };\n    function giftIcon(a){\n        if(!a || !a.gid){ return;}\n        // a.gid\n        return '<img class=\"img\" src=\"'+ giftList[a.gid] +'\" >';\n    };\n    function sendTimes(a){\n        var time = a.timer ?\n            '<span class=\"message gift\">'+a.timer+'</span><span class=\"message fixed\">连击</span>' :\n            '<span class=\"message gift\">'+a.gnum+'</span><span class=\"message fixed\">粒</span>';\n        return time;\n    };\n    function followUser(d){\n        if(!d.nick || d.nick == ''){\n            return;\n        }\n        return '<span class=\"person-name normal\">'+d.nick+'</span><span class=\"message\">关注了主播</span>';\n    };\n    function followStatus(a) {\n        if(a == '1'){\n            $('.follow-btn').addClass('cancel').text('已关注');\n        }else{\n            $('.follow-btn').removeClass('cancel').text('关注');\n        }\n    };\n    function silenceM(a) {\n        if(!a || !a.admin || !a.adminNick){\n            return;\n        }\n        return '<span class=\"message\" style=\"color:#f44336;\">系统广播：用户</span><span class=\"message\" style=\"color:#f44336;\">'+a.targetNick+'</span><span class=\"message\" style=\"color:#f44336;\">被房管</span><span class=\"message\" style=\"color:#f44336;\">'+a.adminNick+'</span><span class=\"message\" style=\"color:#f44336;\">禁言一小时</span>';\n    };\n    $.fn.scrollTo =function(options){\n        var defaults = {\n            toT : $('.chat-container')[0].scrollHeight,    //滚动目标位置\n            durTime : 1000,  //过渡动画时间\n            delay : 10,     //定时器时间\n            callback:function () {\n                return;\n            }   //回调函数\n        };\n        var opts = $.extend(defaults,options),\n            timer = null,\n            _this = this,\n            curTop = _this.scrollTop(),//滚动条当前的位置\n            subTop = opts.toT - curTop,    //滚动条目标位置和当前位置的差值\n            index = 0,\n            dur = Math.round(opts.durTime / opts.delay),\n            smoothScroll = function(t){\n                index++;\n                var per = Math.round(subTop/dur);\n                if(index >= dur){\n                    _this.scrollTop(t);\n                    window.clearInterval(timer);\n                    if(opts.callback && typeof opts.callback == 'function'){\n                        opts.callback();\n                    }\n                    return;\n                }else{\n                    _this.scrollTop(curTop + index*per);\n                }\n            };\n        timer = window.setInterval(function(){\n            smoothScroll(opts.toT);\n        }, opts.delay);\n        return _this;\n    };\n    function domScroll(){\n        $('.chat-container').scrollTo();\n        if($('#chat-div').find('li').length > 88){\n            $('#chat-div').find('li').eq(0).remove();\n        }\n        // $('.chat-container').scrollTop($('.chat-container')[0].scrollHeight);\n    };\n    /* 设置 金豆金币余额 */\n    function setUserCoin(a){\n        $('.gift-content').find('.userMoney').find('.coinMoney').text(digitsFormat(a));\n    };\n    function setUserBean(a){\n        $('.gift-content').find('.userMoney').find('.beanMoney').text(digitsFormat(a));\n    };\n    function setProperty(a) {\n        if(!a || !a.coin || !a.bean){\n            return;\n        }\n        setUserCoin(a.coin);\n        setUserBean(a.bean);\n    };\n    /* mobileTips  1:loading 2:success 3:fail*/\n    function mobileTips(a, b){\n        if(b == 1){\n            $('.mobile-success, .mobile-fail').hide();\n            $('.mobile-loading .loading').html(a);\n            $('.mobile-tip, .mobile-loading').show();\n            setTimeout(function () {\n                $('.mobile-loading .loading').html('');\n                $('.mobile-tip, .mobile-loading').hide();\n            }, 1500)\n        }else if(b == 2){\n            $('.mobile-loading, .mobile-fail').hide();\n            $('.mobile-success .success').html(a);\n            $('.mobile-tip, .mobile-success').show();\n            setTimeout(function () {\n                $('.mobile-success .success').html('');\n                $('.mobile-tip, .mobile-success').hide();\n            }, 1500)\n        }else if(b == 3){\n            $('.mobile-success, .mobile-loading').hide();\n            $('.mobile-fail .fail').html(a);\n            $('.mobile-tip, .mobile-fail').show();\n            setTimeout(function () {\n                $('.mobile-fail .fail').html('');\n                $('.mobile-tip, .mobile-fail').hide();\n            }, 1500)\n        }\n    };\n    function timeSort() {\n        var interval = setInterval(function () {\n            if(beanTime <= 0){\n                beanLock = true;\n                clearInterval(interval);\n                return;\n            }\n            beanTime--;\n            // console.log(beanTime);\n        }, 1000);\n    };\n\n    /* not Login */\n    function loginEvent() {\n        if(!getCookie('_uid') || !getCookie('_enc')){\n            mobileTips('您还没有登录哦~', 3);\n            setTimeout(function () {\n                var refUrl = location.href;\n                setCookie('ref_url', encodeURIComponent(refUrl));\n                location.href =  $conf.domain +'mobile/h5login/index.html?t='+ new Date().getTime();\n            },1200);\n            return false;\n        }else{\n            return true;\n        }\n    };\n});"]}