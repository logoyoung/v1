!function(a){var b={isInit:!1,itemArray:[],itemExists:function(a){var b,c;if(!a||!a.obj)return-1;for(b=this.itemArray.length,c=0;b>c;c++)if(a.obj.selector==this.itemArray[c].obj.selector)return c;return-1},addItem:function(a,b){var c,d;return a?(c={obj:a,options:b,isProcessing:!1,isEnd:!1,tempPreObj:{}},d=this.itemExists(c),-1==d?this.itemArray.push(c):this.itemArray[d]=c,c):!1},scrollFn:function(c,d,e){var h,i,j,k,l,f=!1,g=a(window);if(f)return!0;if(b.log("trigger...",b.itemArray),f=!0,h=g.height(),i=g.scrollTop(),j=c.offset().top,b.log("objOffsetTop:"+j+", windowHeight:"+h+", scrollTop:"+i),e){if(e.y>e.maxScrollY)return f=!1,!0}else if(h+i<j-(d.offsetY?d.offsetY:0))return f=!1,!0;for(k in b.itemArray)l=b.itemArray[k],l.options.bPreLoad?b.processPreData(l,l.options.pageCurrent+1,!1):b.process(l);f=!1},init:function(c,d){var e=this.addItem(c,d),f=a(window),g=!1;return d.onInit(c,d),e.options.bPreLoad&&b.processPreLoad(e,e.options.pageCurrent+1),d.bLoadOnInit&&(e.options.bPreLoad?this.processPreData(e,e.options.pageCurrent+1,!1):this.process(e)),this.isInit?!1:(this.isInit=!0,f.on("scroll",function(){b.scrollFn(c,d,window.iscrollObj),window.iscrollObj?g||(iscrollObj.on("scrollEnd",function(){b.scrollFn(c,d,iscrollObj)}),g=!0):g=!1}).trigger("scroll"),void 0)},process:function(c){return c.isProcessing||c.isEnd?!1:(b.log("process...",c,b.itemArray),c.isProcessing=!0,c.options.onProcess(c.obj,c.options),a.ajax({url:c.options.urlFormater(c.options,c.options.url,++c.options.pageCurrent),data:c.options.paramters(c.options.pageCurrent),dataType:null==c.options.jsonp?"json":"jsonp",jsonp:c.options.jsonp,success:function(a){b.log("process data...",c,b.itemArray),b.processData(c,a,!1),c.isEnd||c.options.onPrcessDone(c.obj,a,c.options),c.isProcessing=!1,b.log("process done...",c,b.itemArray),c.options.processCallback(c.obj,a,c.options)}}),void 0)},processPreLoad:function(c,d){c.tempPreObj[d]={bTrigger:!1,bLoaded:!1,data:null},a.ajax({url:c.options.urlFormater(c.options,c.options.url,d),data:c.options.paramters(d),dataType:null==c.options.jsonp?"json":"jsonp",jsonp:c.options.jsonp,success:function(a){c.tempPreObj[d].bLoaded=!0,c.tempPreObj[d].data=a,d-c.options.pageCurrent<=1&&b.processData(c,a,!0),c.tempPreObj[d].bTrigger&&!c.isEnd&&b.processPreData(c,d,!0)}})},processPreData:function(a,c,d){var e=a.tempPreObj[c];if(!e)return!1;if(e.bTrigger=!0,!d){if(a.isProcessing||a.isEnd)return!1;b.log("process...",a,b.itemArray),a.isProcessing=!0,a.options.onProcess(a.obj,a.options)}return e.bLoaded?(b.log("process data...",a,b.itemArray),b.processData(a,e.data,!1),a.isEnd||a.options.onPrcessDone(a.obj,e.data,a.options),a.isProcessing=!1,b.log("process done...",a,b.itemArray),a.options.processCallback(a.obj,e.data,a.options),delete a.tempPreObj[c],a.options.pageCurrent++,b.processPreLoad(a,c+1),void 0):!1},isEmptyData:function(b){return!b||a.isArray(b)&&0==b.length||a.isEmptyObject(b)?!0:!1},processData:function(b,c,d){if(c=b.options.dataFormater(c),this.isEmptyData(c))return b.isEnd=!0,b.options.onDone(b.obj,c,b.options),b.options.doneCallback(b.obj,c,b.options),!1;if(d)return!0;var e=b.options.htmlFormater(c);a(b.options.containerSelector).append(e),window.iscrollObj?iscrollObj.refresh():!1},log:function(){if(!a.fn.nextpage.debug)return!1;for(var b in arguments)console.log(arguments[b])}};a.fn.nextpage=function(c){c=a.extend({},a.fn.nextpage.defaults,c),null==c.url&&(c.url=window.location.href),b.init(a(this),c)},a.fn.nextpage.debug=!1,a.fn.nextpage.defaults={url:null,paramters:function(){return{}},jsonp:null,pageCurrent:1,pageSize:20,containerSelector:"#nextpage-container",templateId:"nextpage-template",offsetY:100,urlFormatNum:1,urlFormater:function(a,b,c){var d=b,e="",f=b.indexOf("?");return-1!=f&&(d=b.substring(0,f),e=b.substring(f)),e?e+="&page="+c:e="?page="+c,d+e},dataFormater:function(a){return a.data},htmlFormater:function(a){return baidu.template(this.templateId,a)},htmlTip:"向上滑动加载更多",htmlLoad:"正在加载更多信息",htmlDone:"没有更多内容了~",bLoadOnInit:!1,bPreLoad:!1,onInit:function(a){a.html(this.htmlTip)},onProcess:function(a){a.html(this.htmlLoad)},onPrcessDone:function(a){a.html(this.htmlTip)},onDone:function(a){a.html(this.htmlDone)},processCallback:function(){},doneCallback:function(){}}}("undefined"==typeof Zepto?jQuery:Zepto);